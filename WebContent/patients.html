<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patient Management</title>
    <script src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script src="./function-management.js"></script>

    <style>
        /* Add your CSS styling here */
        .selected {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <h2>Add Patient</h2>
    <form id="addPatientForm">
        Name: <input type="text" id="name" required><br>
        Age: <input type="number" id="age" required><br>
        Gender: <input type="text" id="gender" required><br>
        User ID: <input type="number" id="userId" required><br>
        <button type="submit">Add Patient</button>
    </form>

    <h2>Patients</h2>
    <table id="patientsTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>User ID</th>
            </tr>
        </thead>
        <tbody>
            <!-- Patients will be listed here -->
        </tbody>
    </table>

    <button id="updatePatient">Update Selected Patient</button>
    <button id="deletePatient">Delete Selected Patient</button>

 
    <script>
       
       $(document).ready(function() {
    var selectedPatientId = null;

    function refreshPatientTable() {
        getAllPatients().then(patients => {
            console.log(patients);
            var rows = patients.map(p => 
                `<tr data-patient-id="${p.patientId}" class="patient-row">
                    <td>${p.name}</td>
                    <td>${p.age}</td>
                    <td>${p.gender}</td>
                    <td>${p.userId}</td>
                </tr>`
            ).join('');
            $('#patientsTable tbody').html(rows);
        });
    }

    $('#patientsTable').on('click', '.patient-row', function() {
        $('#patientsTable tr').removeClass('selected');
        $(this).addClass('selected');
        selectedPatientId = $(this).data('patientId');

        // Debugging
        console.log('Selected patient ID:', selectedPatientId);

        // Load patient data into form for editing
        var patientName = $(this).children('td').eq(0).text();
        var patientAge = $(this).children('td').eq(1).text();
        var patientGender = $(this).children('td').eq(2).text();
        var userId = $(this).children('td').eq(3).text();

        
        $('#name').val(patientName);
        $('#age').val(patientAge);
        $('#gender').val(patientGender);
        $('#userId').val(userId);
    });

    $('#addPatientForm').submit(function(e) {
        e.preventDefault();
        var patientData = {
            name: $('#name').val(),
            age: parseInt($('#age').val(), 10),
            gender: $('#gender').val(),
            userId: parseInt( $('#userId').val())
        
        };

        if (selectedPatientId) {
            updatePatient(selectedPatientId, patientData).then(() => {
                refreshPatientTable();
                clearForm();
            });
        } else {
            addPatient(patientData).then(() => {
                refreshPatientTable();
                clearForm();
            });
        }
    });

    $('#deletePatient').click(function() {
        if (selectedPatientId) {
            deletePatient(selectedPatientId).then(() => {
                refreshPatientTable();
                clearForm();
            });
        } else {
            alert('No patient selected for deletion.');
        }
    });

    $('#updatePatient').click(function() {
        if (selectedPatientId) {
            var patientData = {
                name: $('#name').val(),
                age: parseInt($('#age').val(), 10),
                gender: $('#gender').val(),
                userId: parseInt( $('#userId').val())
            };
            updatePatient(selectedPatientId, patientData).then(() => {
                refreshPatientTable();
                clearForm();
            }).catch(error => {
                console.error('Update failed:', error);
                alert('Update failed. Check console for details.');
            });
        } else {
            alert('No patient selected for update.');
        }
    });

    function clearForm() {
        $('#name').val('');
        $('#age').val('');
        $('#gender').val('');
        $('#userId').val('');
        selectedPatientId = null;
        $('#patientsTable tr').removeClass('selected');
    }

    refreshPatientTable();
});



    </script>

</body>
</html>
